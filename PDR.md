Это итоговое техническое задание (PRD), составленное с учетом твоих требований к стеку, функционалу и дизайну. Оно готово для передачи разработчику или ИИ-агенту.

---

# Technical Requirements: Deloculator Telegram Mini App (TMA)

## 1. Общее описание

Создать Telegram Mini App (TMA) для оперативного расчета стоимости заказов на основе существующего справочника изделий. Приложение должно заменять текущий Excel-калькулятор, обеспечивая мобильность, сохранение сессий (проектов) и чистый, минималистичный интерфейс.

## 2. Технологический стек

* **Backend:** Python (FastAPI).
* **Database:** SQLite (хранение проектов и сессий).
* **Frontend:** HTML5, JS (Vanilla или Alpine.js), Tailwind CSS (через CDN для легкости правок).
* **Data Source:** Синхронизация «Справочника изделий» из Google Sheets (через экспорт в CSV или API).
* **Infrastructure:** Развертывание на собственном VPS заказчика.

## 3. Функциональные модули

### A. Dashboard (Главный экран)

* Список сохраненных проектов (сортировка по дате создания, от новых к старым).
* Карточка проекта: Название, Клиент, Дата, Итоговая сумма.
* Кнопка «+ Новый расчет».

### B. Конструктор проекта (Экран расчета)

* **Метаданные проекта (Глобальные настройки):**
* Поле ввода: Название проекта.
* Поле ввода: Имя клиента.
* Поле ввода: Глобальная скидка (%).
* Поле ввода: Налог (%).


* **Управление позициями:**
* Кнопка «Добавить изделие»: открывает поиск по справочнику.
* Поиск/Dropdown с автодополнением (подтягивает данные из справочника).
* Возможность ручного ввода названия, если изделия нет в базе.
* Поле: Количество (шт).


* **Список добавленных позиций:**
* Компактные строки: `Название | Кол-во | Базовая цена`.
* Возможность удаления позиции (свайп или иконка).



### C. Сводка (Summary)

* Sticky-панель в нижней части экрана (всегда видна).
* **Показатели в реальном времени:**
* Выручка (с учетом скидки и налога).
* Себестоимость (суммарная).
* Чистая прибыль.
* Рентабельность (%).



## 4. Структура данных (SQLite)

### Table: `projects`

* `id` (Integer, PK)
* `name` (String)
* `client` (String)
* `global_discount` (Float, default 0)
* `global_tax` (Float, default 0)
* `created_at` (Timestamp)

### Table: `project_items`

* `id` (Integer, PK)
* `project_id` (FK -> projects.id)
* `name` (String)
* `type` (String)
* `base_price` (Float) — цена из справочника на момент добавления.
* `cost_price` (Float) — себестоимость на момент добавления.
* `quantity` (Integer)

### Table: `product_catalog` (Кеш из Google Sheets)

* `id`, `name`, `type`, `base_price`, `cost_price`.
* *Обновляется фоновым скриптом раз в час.*

## 5. Логика расчетов

1. `Subtotal = Sum(item.base_price * item.quantity)`
2. `Total_Revenue = Subtotal * (1 - global_discount / 100) * (1 + global_tax / 100)`
3. `Total_Cost = Sum(item.cost_price * item.quantity)`
4. `Profit = Total_Revenue - Total_Cost`

## 6. UI/UX Гайдлайны

* **Стиль:** Минимализм, Apple-style или Material Design 3.
* **Цвета:** Светлая тема с акцентами на важных цифрах (Прибыль — зеленый).
* **Интерактив:** Мгновенный пересчет всех итогов при изменении любого поля (input change event).
* **Компактность:** Минимум отступов, использование всей ширины экрана мобильного устройства.

---

**Хочешь, чтобы я подготовил для разработчика еще и пример структуры JSON-ответа от бэкенда или набросал пример функции синхронизации с Google Таблицей?**